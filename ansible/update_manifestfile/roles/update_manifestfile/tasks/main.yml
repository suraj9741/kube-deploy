---
- name: Install required system packages
  apt:
    pkg:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
      - python3-pip
      - virtualenv
      - python3-setuptools
    state: latest
    update_cache: true

- name: Install Docker Module for Python
  pip:
    name: docker

- name: Docker login 
  community.docker.docker_login:
    username: "{{ username }}"
    password: "{{ password }}"

- name: Clone a repo with separate git directory
  ansible.builtin.git:
    repo: https://github.com/ansible/ansible-examples.git
    dest: /home/ubuntu/kube-deploy

- name: Execute hostname command in remote shell
  shell: hostname
  register: displaylist

- name: show displaylist
  debug:
    var: "{{displaylist.stdout_lines}}"

- name: Execute ls command in remote shell
  shell: ls
  register: displaylist

- name: show displaylist
  debug:
    var: "{{displaylist.stdout_lines}}"

- name: Execute pwd command in remote shell
  shell: pwd
  register: displaylist

- name: show displaylist
  debug:
    var: "{{displaylist.stdout_lines}}"

# - name: Replace a image with laltest iamge
#   replace:
#     path: k8s/fask-app.yml
#     regexp: '(?<= image: )(.*)$'
#     replace: 'suraj9741/koko:{{ tag }}'

# - name: Replace old hostname with new hostname (requires Ansible >= 2.4)
#   ansible.builtin.replace:
#     path: /etc/hosts
#     regexp: '(\s+)old\.host\.name(\s+.*)?$'
#     replace: '\1new.host.name\2'